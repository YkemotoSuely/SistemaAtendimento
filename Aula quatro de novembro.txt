Aula 04/11/2025

Formulário Atendimento

para desativar os botões = enabled = false

para desativar campos: 
TxtBox = ReadOnly = True
combo box - enable = false

1) clicar 2X no botão NOVO no formulário, abrirá o código (FrmAtendimento)com o metodo btnNovo_Click:

 private void btnNovo_Click(object sender, EventArgs e)
 {
     HabilitarCampos();
 }

 Criar o método HabilitarCampos antes  e depois dentro do método btnNovo _Click  

 private void HabilitarCampos() 
 {   //Campos do formulário
     cbxNomeCliente.Enabled = true;
     dtpAberturaAtendimento.Enabled = true;
     cbxSituacaoAtendimento.Enabled = true;
     txtObservacaoAtendimento.ReadOnly = false;
     //botões do formulário
     btnNovo.Enabled = false;
     btnSalvar.Enabled = true;
     btnCancelar.Enabled = true;
 }

2)clicar 2X no botão CANCELAR no formulário, abrirá o código com o metodo btnCancelar_Click:

private void btnCancelar_Click(object sender, EventArgs e)
{
    DesativarCampos();
}

private void DesativarCampos() 
{
    LimparCampos();

    cbxNomeCliente.Enabled = false;
    dtpAberturaAtendimento.Enabled = false;
    cbxSituacaoAtendimento.Enabled = false;
    txtObservacaoAtendimento.ReadOnly = true;
    //botões do formulário
    btnNovo.Enabled = true;
    btnSalvar.Enabled = false;
    btnCancelar.Enabled = false;
}
private void LimparCampos() 
{
    txtCodigoCliente.Clear();
    cbxNomeCliente.SelectedIndex = -1;
    cbxSituacaoAtendimento.SelectedIndex = -1;
    txtObservacaoAtendimento.Clear();
    dtpAberturaAtendimento.Value = DateTime.Now;

}

3) 2)clicar 2X no botão SALVAR no formulário, abrirá o código com o metodo btnSalvar_Click:

private void btnSalvar_Click(object sender, EventArgs e)
{
       Atendimentos atendimento = new Atendimentos
    {
        ClienteId = Convert.ToInt32(txtCodigoCliente.Text),
        UsuarioId = 1,
        SituacaoAtendimentoId = Convert.ToInt32(cbxSituacaoAtendimento.SelectedValue),
        DataAbertura = dtpAberturaAtendimento.Value,
        Observacao = txtObservacaoAtendimento.Text
    };

    if (ValidarDados(atendimento))
    {
        return;
    }    
}
private bool ValidarDados(Atendimentos atendimento) 
{
    //Criar regras de validação de campos


    return true;
}
__________________________________________________________________________________________

Aula 05/11/2025

Continuando...

Criando as regras de Validação

Se usamos o Convert e o campo pode receber null em um campo 

ClienteId = string.IsNullOrWhiteSpace((txtCodigoCliente.Text)?null : Convert.ToInt32(txtCodigoCliente.Text),

esse trecho do código verifica se o campo está vazio, aí converterá. Contudo é necessátio voltar na pasta MODEL e acrescentar "?" na frente 
do tipo das variáveis, indicando assim que os campos aceitarão valor nulo:
Ex.:
public class Atendimentos
{
    public int Id { get; set; }
    public int? ClienteId { get; set; }
    public int? UsuarioId { get; set; }
    public DateTime? DataAbertura { get; set; }
    public DateTime? DataFechamento { get; set; }
    public string? Observacao { get; set; }
    public int? SituacaoAtendimentoId { get; set; }
    public string? ClienteNome { get; set; }
    public string? SituacaoAtendimentoNome { get; set; }
    public string? UsuarioNome { get; set; }
    public string? CpfCnpj { get; set; }

}

Feitas as validações, vamos à proxima função: Salvar

No AtendimentoController implantamos o método:

public void Salvar(Atendimentos atendimento)  
{
    try
    {
        _atendimentoRepository.Inserir(atendimento);
        _frmAtendimento.ExibirMensagem("Atenidmento salvo com sucesso!");
    }
    catch (Exception ex)
    {
        _frmAtendimento.ExibirMensagem($"Erro ao cadastrar o Atendimento: {Mensagem}");
    }
}

Então volto lá no FRMAtendimento e chamo a função SALVAR lá no método  btnSalvar_Click:
private void btnSalvar_Click(object sender, EventArgs e)
{
    Atendimentos atendimento = new Atendimentos
    {
        ClienteId = string.IsNullOrWhiteSpace(txtCodigoCliente.Text) ? null : Convert.ToInt32(txtCodigoCliente.Text),
        UsuarioId = 1,
        SituacaoAtendimentoId = cbxSituacaoAtendimento.SelectedValue ==  null ? null: Convert.ToInt32(cbxSituacaoAtendimento.SelectedValue),
        DataAbertura = dtpAberturaAtendimento.Value,
        Observacao = txtObservacaoAtendimento.Text
    };

    if (!ValidarDados(atendimento))
    {
        return;
        
        _atendimentoController.Salvar(atendimento);
    }    
}

---------------------------------------------------------------------------------
29/11/2025

1)criando o model "Etapas de Atendimento"

2)Criando o repository "Etapa de Atendimento" - 3 funções Inserir; Excluir(Id) e Listar(relacionado ao AtendimentoId)